<!DOCTYPE html>
<html><head><meta charset="UTF-8"><link href="css/default.css" rel="stylesheet" type="text/css"><script src="js/jquery.min.js" type="text/javascript"></script><script src="js/page_effects.js" type="text/javascript"></script><title>shrubbery.core documentation</title></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a></h2><h1><a href="index.html">Shrubbery 0.3.0 API documentation</a></h1></div><div class="sidebar" id="namespaces"><h3><a href="index.html"><span class="inner">Namespaces</span></a></h3><ul><li class="depth-1"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>shrubbery</span></div></div></li><li class="depth-2"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>clojure</span></div></div></li><li class="depth-3"><a href="shrubbery.clojure.test.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>test</span></div></a></li><li class="depth-2 current"><a href="shrubbery.core.html"><div class="inner"><span class="tree" style="top: -52px;"><span class="top" style="height: 61px;"></span><span class="bottom"></span></span><span>core</span></div></a></li></ul></div><div class="sidebar" id="vars"><h3><a href="#top"><span class="inner">Public Vars</span></a></h3><ul><li class="depth-1"><a href="shrubbery.core.html#var-anything"><div class="inner"><span>anything</span></div></a></li><li class="depth-1"><a href="shrubbery.core.html#var-call-count"><div class="inner"><span>call-count</span></div></a></li><li class="depth-1"><a href="shrubbery.core.html#var-Matcher"><div class="inner"><span>Matcher</span></div></a></li><li class="depth-2"><a href="shrubbery.core.html#var-matches.3F"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>matches?</span></div></a></li><li class="depth-1"><a href="shrubbery.core.html#var-mock"><div class="inner"><span>mock</span></div></a></li><li class="depth-1"><a href="shrubbery.core.html#var-protocol.3F"><div class="inner"><span>protocol?</span></div></a></li><li class="depth-1"><a href="shrubbery.core.html#var-protocols"><div class="inner"><span>protocols</span></div></a></li><li class="depth-1"><a href="shrubbery.core.html#var-received.3F"><div class="inner"><span>received?</span></div></a></li><li class="depth-1"><a href="shrubbery.core.html#var-returning"><div class="inner"><span>returning</span></div></a></li><li class="depth-1"><a href="shrubbery.core.html#var-Spy"><div class="inner"><span>Spy</span></div></a></li><li class="depth-2 branch"><a href="shrubbery.core.html#var-calls"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>calls</span></div></a></li><li class="depth-2"><a href="shrubbery.core.html#var-proxied"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>proxied</span></div></a></li><li class="depth-1"><a href="shrubbery.core.html#var-spy"><div class="inner"><span>spy</span></div></a></li><li class="depth-1"><a href="shrubbery.core.html#var-spy.3F"><div class="inner"><span>spy?</span></div></a></li><li class="depth-1"><a href="shrubbery.core.html#var-Stub"><div class="inner"><span>Stub</span></div></a></li><li class="depth-2"><a href="shrubbery.core.html#var-all-stubs"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>all-stubs</span></div></a></li><li class="depth-1"><a href="shrubbery.core.html#var-stub"><div class="inner"><span>stub</span></div></a></li><li class="depth-1"><a href="shrubbery.core.html#var-stub.3F"><div class="inner"><span>stub?</span></div></a></li></ul></div><div class="namespace-docs" id="content"><h2 class="anchor" id="top">shrubbery.core</h2><div class="doc"><div class="markdown"><p>A collection of functions for creating and querying stubs, spies, and mocks.</p></div></div><div class="public anchor" id="var-anything"><h3>anything</h3><div class="usage"></div><div class="doc"><div class="markdown"><p>A <a href="shrubbery.core.html#var-Matcher">Matcher</a> that always returns true.</p></div></div></div><div class="public anchor" id="var-call-count"><h3>call-count</h3><div class="usage"><code>(call-count aspy avar)</code><code>(call-count aspy avar args)</code></div><div class="doc"><div class="markdown"><p>Given a <a href="shrubbery.core.html#var-spy">spy</a>, a var, and an optional vector of args, return the number of times the spy received the method. If given args, filters the list of calls by matching the given args. Matched args may implement the <a href="shrubbery.core.html#var-Matcher">Matcher</a> protocol; the default implementation for <code>Object</code> is <code>=</code>.</p></div></div></div><div class="public anchor" id="var-Matcher"><h3>Matcher</h3><h4 class="type">protocol</h4><div class="usage"></div><div class="doc"><div class="markdown"><p>A protocol for defining argument equality matching. Default implementations are provided for <code>Object</code> (equality), <code>Pattern</code> (regexp matching), and <code>IFn</code> (execution). There is also a wildcard matcher, <a href="shrubbery.core.html#var-anything">anything</a>.</p></div></div><div class="members"><h4>members</h4><div class="inner"><div class="public anchor" id="var-matches.3F"><h3>matches?</h3><div class="usage"><code>(matches? matcher value)</code></div><div class="doc"><div class="markdown"></div></div></div></div></div></div><div class="public anchor" id="var-mock"><h3>mock</h3><div class="usage"><code>(mock &amp; protos-and-impls)</code></div><div class="doc"><div class="markdown"><p>Given a protocol and a hashmap of function implementations, returns a new implementation of that protocol with those implementations. The returned implementation is also a spy, allowing you to inspect and assert against its calls. See <a href="shrubbery.core.html#var-spy">spy</a> and <a href="shrubbery.core.html#var-stub">stub</a>.</p></div></div></div><div class="public anchor" id="var-protocol.3F"><h3>protocol?</h3><div class="usage"><code>(protocol? p)</code></div><div class="doc"><div class="markdown"><p>True if p is a protocol.</p></div></div></div><div class="public anchor" id="var-protocols"><h3>protocols</h3><div class="usage"><code>(protocols o)</code></div><div class="doc"><div class="markdown"><p>Given an object, attempt to return the set of all protocols it reifies. Warning: this may choke on nonstandard package and namespace choices. Pull requests and bug reports welcome.</p></div></div></div><div class="public anchor" id="var-received.3F"><h3>received?</h3><div class="usage"><code>(received? aspy avar)</code><code>(received? aspy avar args)</code></div><div class="doc"><div class="markdown"><p>Given a <a href="shrubbery.core.html#var-spy">spy</a> and a method reference, return true if the method has been called on the spy at least once. If given args, filters the list of calls by matching the given args. Matched args may implement the <a href="shrubbery.core.html#var-Matcher">Matcher</a> protocol; the default implementation for <code>Object</code> is <code>=</code>.</p></div></div></div><div class="public anchor" id="var-returning"><h3>returning</h3><div class="usage"><code>(returning s proto new-stubs)</code></div><div class="doc"><div class="markdown"><p>Given a <a href="shrubbery.core.html#var-stub">stub</a> or <a href="shrubbery.core.html#var-mock">mock</a>, a protocol, and a hashmap of implementations, return a new stub that replaces the stubs for the named function with the given stubs.</p></div></div></div><div class="public anchor" id="var-Spy"><h3>Spy</h3><h4 class="type">protocol</h4><div class="usage"></div><div class="doc"><div class="markdown"><p>A protocol shared by spies.</p></div></div><div class="members"><h4>members</h4><div class="inner"><div class="public anchor" id="var-calls"><h3>calls</h3><div class="usage"><code>(calls t)</code></div><div class="doc"><div class="markdown"><p>Returns a map of function names to lists of received args, one for each time the function is called.</p></div></div></div><div class="public anchor" id="var-proxied"><h3>proxied</h3><div class="usage"><code>(proxied t)</code></div><div class="doc"><div class="markdown"><p>Returns the underlying object this spy proxies its calls to.</p></div></div></div></div></div></div><div class="public anchor" id="var-spy"><h3>spy</h3><div class="usage"><code>(spy o)</code><code>(spy o protos)</code></div><div class="doc"><div class="markdown"><p>Given an object implementing one or more protocols, returns a new object that records each call to underlying protocol functions, then proxies to the original implementation. The returned object also implements <code>Spy</code>, which exposes those calls. If an explicit list of protocols is not given, the list will be inferred from the given object. For spies with added implementation, see <a href="shrubbery.core.html#var-mock">mock</a>. For queryies against spies, see <a href="shrubbery.core.html#var-call-count">call-count</a> and <a href="shrubbery.core.html#var-received.3F">received?</a>.</p></div></div></div><div class="public anchor" id="var-spy.3F"><h3>spy?</h3><div class="usage"><code>(spy? s)</code></div><div class="doc"><div class="markdown"><p>True if s reifies Spy.</p></div></div></div><div class="public anchor" id="var-Stub"><h3>Stub</h3><h4 class="type">protocol</h4><div class="usage"></div><div class="doc"><div class="markdown"><p>A protocol shared by stubs.</p></div></div><div class="members"><h4>members</h4><div class="inner"><div class="public anchor" id="var-all-stubs"><h3>all-stubs</h3><div class="usage"><code>(all-stubs t)</code></div><div class="doc"><div class="markdown"><p>Returns a normalized hashmap of all known stubs prior to reification.</p></div></div></div></div></div></div><div class="public anchor" id="var-stub"><h3>stub</h3><div class="usage"><code>(stub &amp; protos-and-impls)</code></div><div class="doc"><div class="markdown"><p>Given a variable number of protocols, each followed by an optional hashmap of simple implementations, returns a new object implementing those protocols. Where no function implementation is provided, calls to that protocol function will return <code>nil</code> rather than raising <code>IllegalArgumentException</code>. Functions as values are not supported, as they require side effects to define; for more complex stubs, prefer using <code>reify</code>. For stubs with call count recording, use <a href="shrubbery.core.html#var-mock">mock</a>.</p></div></div></div><div class="public anchor" id="var-stub.3F"><h3>stub?</h3><div class="usage"><code>(stub? s)</code></div><div class="doc"><div class="markdown"><p>True if s reifies Stub.</p></div></div></div></div></body></html>